<!DOCTYPE html>
<html>
<head>
    <title>Judging Scores Entry Form</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        #score-form {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 400px;
            position: relative;
        }
        #loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            color: #007BFF;
        }
        h1, h3 {
            text-align: center;
            color: #333;
        }
        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            width: 100%;
            background-color: #007BFF;
            color: #ffffff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #999;
            cursor: not-allowed;
        }
        input[type="number"]:invalid {
            border-color: red;
        }
        @media (max-width: 600px) {
            #score-form {
                width: 90%;
                padding: 10px;
            }
            label {
                font-size: 1em;
            }
            select, input[type="text"], input[type="number"] {
                font-size: 1em;
            }
            button {
                padding: 8px;
                font-size: 1em;
            }
        }
    </style>
    <script>
        const categories = {
            "I1": { name: "Dhun Dhamaka", sheetName: "DhunDhamaka", criteria: ["Technical Skill (max 40)", "Creativity & Originality (max 30)", "Stage Presence (max 20)", "Audience Engagement (max 10)"] },
            "ACT": { name: "Dramebaaz", sheetName: "Dramebaaz", criteria: ["Acting Skills (max 50)", "Creativity & Script (max 30)", "Stage Presence & Coordination (max 20)"] },
            "S1": { name: "Sur Ki Mehfil", sheetName: "SurKiMehfil", criteria: ["Vocal Quality (max 40)", "Song Selection & Interpretation (max 30)", "Stage Presence (max 20)", "Audience Engagement (max 10)"] },
            "S2": { name: "Sur Ki Mehfil", sheetName: "SurKiMehfil", criteria: ["Vocal Quality (max 40)", "Song Selection & Interpretation (max 30)", "Stage Presence (max 20)", "Audience Engagement (max 10)"] },
            "SJ": { name: "Surila Jugaad", sheetName: "SurilaJugaad", criteria: ["Vocal Quality (max 60)", "Instrumental Skill (max 60)", "Creativity & Harmony (max 50)", "Stage Presence & Audience Engagement (max 30)"] },
            "SP1": { name: "Shabdon Ka Jadoo", sheetName: "ShabdonKaJadoo", criteria: ["Content Quality (max 40)", "Delivery & Expression (max 30)", "Creativity & Originality (max 20)", "Audience Engagement (max 10)"] },
            "SP2": { name: "Batein Bindaas", sheetName: "BateinBindaas", criteria: ["Content Quality (max 40)", "Delivery & Expression (max 30)", "Creativity & Originality (max 20)", "Audience Engagement (max 10)"] },
            "SP3": { name: "Vicharon Ki Udaan", sheetName: "VicharonKiUdaan", criteria: ["Content Quality (max 40)", "Delivery & Expression (max 30)", "Creativity & Originality (max 20)", "Audience Engagement (max 10)"] },
            "SPC3": { name: "Bachchon Ki Boli", sheetName: "BachchonKiBoli", criteria: ["Content Quality (max 40)", "Delivery & Expression (max 30)", "Creativity & Originality (max 20)", "Audience Engagement (max 10)"] },
            "DC1": { name: "Chote Ustaad", sheetName: "ChoteUstaad", criteria: ["Technical Skill (max 40)", "Creativity & Originality (max 30)", "Choreography & Execution (max 20)", "Stage Presence (max 10)"] },
            "DC2": { name: "Chote Ustaad", sheetName: "ChoteUstaad", criteria: ["Technical Skill (max 40)", "Creativity & Originality (max 30)", "Choreography & Execution (max 20)", "Stage Presence (max 10)"] },
            "DT1": { name: "Boogie Woogie", sheetName: "BoogieWoogie", criteria: ["Technical Skill (max 40)", "Creativity & Originality (max 30)", "Choreography & Execution (max 20)", "Stage Presence (max 10)"] },
            "DT2": { name: "Boogie Woogie", sheetName: "BoogieWoogie", criteria: ["Technical Skill (max 40)", "Creativity & Originality (max 30)", "Choreography & Execution (max 20)", "Stage Presence (max 10)"] },
            "DA1": { name: "Vibe Explosion", sheetName: "VibeExplosion", criteria: ["Technical Skill (max 40)", "Creativity & Originality (max 30)", "Choreography & Execution (max 20)", "Stage Presence (max 10)"] },
            "DA2": { name: "Vibe Explosion", sheetName: "VibeExplosion", criteria: ["Technical Skill (max 40)", "Creativity & Originality (max 30)", "Choreography & Execution (max 20)", "Stage Presence (max 10)"] },
            "DG1": { name: "Nach Baliye", sheetName: "NachBaliye", criteria: ["Dance Technique (max 40)", "Choreography & Synchronization (max 30)", "Stage Presence (max 20)", "Audience Engagement (max 10)"] },
            "DG2": { name: "Nach Baliye", sheetName: "NachBaliye", criteria: ["Dance Technique (max 40)", "Choreography & Synchronization (max 30)", "Stage Presence (max 20)", "Audience Engagement (max 10)"] },
            "DG3": { name: "Nach Baliye", sheetName: "NachBaliye", criteria: ["Dance Technique (max 40)", "Choreography & Synchronization (max 30)", "Stage Presence (max 20)", "Audience Engagement (max 10)"] },
            "PH": { name: "PowerHouse", sheetName: "PowerHouse", criteria: ["Dance Technique (max 80)", "Choreography & Synchronization (max 60)", "Stage Presence (max 40)", "Audience Engagement (max 20)"] },
            "SKIT": { name: "RangManch", sheetName: "RangManch", criteria: ["Acting Skills (max 200)", "Creativity & Script (max 150)", "Stage Presence & Coordination (max 100)", "Audience Engagement (max 50)"] },
            "FS": { name: "Final Showdown", sheetName: "FinalShowdown", criteria: ["Performance Quality (max 200)", "Creativity & Originality (max 150)", "Stage Presence & Teamwork (max 100)", "Audience Engagement (max 50)"] },
        };

        function updateCategoryDetails() {
            const categoryId = document.getElementById("category").value;
            const category = categories[categoryId];
            const criteriaContainer = document.getElementById("criteria-container");
            if (category) {
                document.getElementById("category-name").value = category.name;
                criteriaContainer.innerHTML = "";
                category.criteria.forEach((criterion) => {
                    const label = document.createElement("label");
                    label.textContent = criterion + ":";
                    const input = document.createElement("input");
                    input.type = "number";
                    input.className = "score-input";
                    input.min = "0";
                    input.max = criterion.match(/\(max (\d+)\)/)[1];
                    input.oninput = function () {
                        if (parseInt(input.value) > parseInt(input.max)) {
                            input.setCustomValidity("Value exceeds maximum allowed");
                        } else {
                            input.setCustomValidity("");
                        }
                    };
                    criteriaContainer.appendChild(label);
                    criteriaContainer.appendChild(input);
                    criteriaContainer.appendChild(document.createElement("br"));
                });
            } else {
                document.getElementById("category-name").value = "";
                criteriaContainer.innerHTML = "<p>No criteria available for this category.</p>";
            }
        }

        async function saveScores() {
            const spreadsheetId = '1i3OGdne9Hok1th-I3UMtXgDGOcxGsXDRHZx9A6j_CYw';
            const categoryId = document.getElementById("category").value;
            const category = categories[categoryId];
            if (!category) {
                alert('Please select a valid category.');
                return;
            }
            const team = document.getElementById("team").value;
            if (!team) {
                alert('Please select a team.');
                return;
            }

            const scores = [];
            let allFieldsFilled = true;

            document.querySelectorAll('.score-input').forEach((input) => {
                if (input.value === "") {
                    allFieldsFilled = false;
                }
                scores.push(input.value);
            });

            if (!allFieldsFilled) {
                alert('Please fill in all score fields.');
                return;
            }

            const range = `${category.sheetName}`;
            const values = [
                [
                    team,
                    categoryId,
                    category.name,
                    ...scores
                ]
            ];

            const body = {
                values: values  
            };

            const loadingIndicator = document.getElementById("loading");
            loadingIndicator.style.display = "block";
            const saveButton = document.querySelector('#save-button');
            saveButton.disabled = true;

            try {
                const accessToken = await getAccessToken();
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}:append?valueInputOption=RAW`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + accessToken
                    },
                    body: JSON.stringify(body)
                });
                const data = await response.json();
                loadingIndicator.style.display = "none";
                saveButton.disabled = false;
                if (data.updates && data.updates.updatedRows > 0) {
                    alert('Scores saved successfully!');
                    document.getElementById("score-form").reset();
                    document.getElementById("criteria-container").innerHTML = "";
                } else {
                    alert('Failed to save scores. Please try again later.');
                }
            } catch (error) {
                loadingIndicator.style.display = "none";
                saveButton.disabled = false;
                alert('Failed to save scores. Please try again later.');
                console.error('Error saving scores', error);
            }
        }

        function getAccessToken() {
            return new Promise((resolve, reject) => {
                google.accounts.oauth2.initTokenClient({
                    client_id: '142313663588-gf9eelv72dchiqsbc9trlfj81igm2ft0.apps.googleusercontent.com',
                    scope: 'https://www.googleapis.com/auth/spreadsheets',
                    callback: (response) => {
                        if (response.error) {
                            reject(response);
                        } else {
                            resolve(response.access_token);
                        }
                    }
                }).requestAccessToken();
            });
        }
    </script>
</head>
<body>
    <!-- Judging Scores Entry Form -->
    <div id="score-form">
        <h1>Judging Scores Entry Form</h1>
        <form id="score-form">
            <label for="team">Team:</label>
            <select id="team">
                <option value="">Select Team</option>
                <option value="Beat Breakers">Beat Breakers</option>
                <option value="Freya Strikers">Freya Strikers</option>
                <option value="Vidhi Svastha">Vidhi Svastha</option>
                <option value="Vakhariya Titans">Vakhariya Titans</option>
            </select><br><br>

            <label for="category">Category ID:</label>
            <select id="category" onchange="updateCategoryDetails()">
                <option value="">Select Category</option>
                <option value="I1">I1 - Dhun Dhamaka</option>
                <option value="ACT">ACT - Dramebaaz</option>
                <option value="S1">S1 - Sur Ki Mehfil</option>
                <option value="S2">S2 - Sur Ki Mehfil</option>
                <option value="SJ">SJ - Surila Jugaad</option>
                <option value="SP1">SP1 - Shabdon Ka Jadoo</option>
                <option value="SP2">SP2 - Batein Bindaas</option>
                <option value="SP3">SP3 - Vicharon Ki Udaan</option>
                <option value="SPC3">SPC3 - Bachchon Ki Boli</option>
                <option value="DC1">DC1 - Chote Ustaad</option>
                <option value="DC2">DC2 - Chote Ustaad</option>
                <option value="DT1">DT1 - Boogie Woogie</option>
                <option value="DT2">DT2 - Boogie Woogie</option>
                <option value="DA1">DA1 - Vibe Explosion</option>
                <option value="DA2">DA2 - Vibe Explosion</option>
                <option value="DG1">DG1 - Nach Baliye</option>
                <option value="DG2">DG2 - Nach Baliye</option>
                <option value="DG3">DG3 - Nach Baliye</option>
                <option value="PH">PH - PowerHouse</option>
                <option value="SKIT">SKIT - RangManch</option>
                <option value="FS">FS - Final Showdown</option>
            </select><br>
            <label for="category-name">Category Name:</label>
            <input type="text" id="category-name" readonly><br><br>

            <h3>Enter Scores</h3>
            <div id="criteria-container"></div>

            <button type="button" id="save-button" onclick="saveScores()">Save Scores</button>
            <div id="loading"><i class="fas fa-spinner fa-spin"></i> Saving...</div>
        </form>
    </div>
</body>
</html>